<!DOCTYPE html>
<html lang="en">
<head>
    <title>Фараон</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        html {
            background: #00954D;
        }
        .hidden {
            display: none !important;
        }
        #wait {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 200px;
            margin-top: -100px;
            margin-left: -200px;
            text-align: center;
            color: #FFF;
        }
        #wait .lds-ripple {
            margin-bottom: 20px;
        }
        .lds-ripple {
            display: inline-block;
            position: relative;
            width: 64px;
            height: 64px;
        }
        .lds-ripple div {
            position: absolute;
            border: 4px solid #fff;
            opacity: 1;
            border-radius: 50%;
            animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
        }
        .lds-ripple div:nth-child(2) {
            animation-delay: -0.5s;
        }
        @keyframes lds-ripple {
            0% {
                top: 28px;
                left: 28px;
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                top: -1px;
                left: -1px;
                width: 58px;
                height: 58px;
                opacity: 0;
            }
        }
        #players {

        }
        .player-info {
            margin-bottom: 20px;
            padding: 20px 10px;
            opacity: .4;
        }
        .active {
            opacity: 1 !important;
        }
        .player-avatar {
            display: inline-block;
            width: 50px;
            height: 50px;
            margin-right: 10px;
            font-size: 40px;
            font-weight: bold;
            line-height: 50px;
            text-align: center;
            color: #000;
            background-color: #FFF;
            border: 1px solid #FFF;
            border-radius: 50%;
            box-sizing: border-box;
            vertical-align: middle;
        }
        .player-hand {
            display: inline-block;
            vertical-align: middle;
        }
        .player-hand div {
            display: inline-block;
            width: 78px;
            height: 108px;
            margin: 2px;
            background: url(/static/classic-shirt.jpg);
            background-position: center;
            box-shadow: 0 1px 5px rgba(40,40,40,0.7);
            border-radius: 5px;
        }
        #discard {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -70px;
            margin-left: -90px;
        }
        #bank {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -70px;
            margin-right: -90px;
            width: 78px;
            height: 108px;
            background: url(/static/classic-shirt.jpg);
            background-position: -15px -20px;
            box-shadow: 0 1px 5px rgba(40,40,40,0.7);
            border-radius: 5px;
        }
        #hand {
            position: absolute;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: .4;
        }
        #hand .card {
            margin: 3px;
            vertical-align: middle;
        }
        .card {
            display: inline-block;
            width: 78px;
            height: 108px;
            background: url(/static/classic.jpg);
            box-shadow: 0 0 5px rgba(40,40,40,0.7);
            border-radius: 5px;
        }
        .card.classic-2-diamonds { background-position: -26px 363px; }
        .card.classic-3-diamonds { background-position: -110px 363px; }
        .card.classic-4-diamonds { background-position: -194px 363px; }
        .card.classic-5-diamonds { background-position: -278px 363px; }
        .card.classic-6-diamonds { background-position: -362px 363px; }
        .card.classic-7-diamonds { background-position: -446px 363px; }
        .card.classic-8-diamonds { background-position: -530px 363px; }
        .card.classic-9-diamonds { background-position: -614px 363px; }
        .card.classic-10-diamonds { background-position: -698px 363px; }
        .card.classic-jack-diamonds { background-position: -278px 983px; }
        .card.classic-queen-diamonds { background-position: -614px 982px; }
        .card.classic-king-diamonds { background-position: -194px 867px; }
        .card.classic-ace-diamonds { background-position: -530px 867px; }

        .card.classic-2-hearts { background-position: -26px 478px; }
        .card.classic-3-hearts { background-position: -110px 478px; }
        .card.classic-4-hearts { background-position: -194px 478px; }
        .card.classic-5-hearts { background-position: -278px 478px; }
        .card.classic-6-hearts { background-position: -362px 478px; }
        .card.classic-7-hearts { background-position: -446px 478px; }
        .card.classic-8-hearts { background-position: -530px 478px; }
        .card.classic-9-hearts { background-position: -614px 478px; }
        .card.classic-10-hearts { background-position: -698px 478px; }
        .card.classic-jack-hearts { background-position: -110px 983px; }
        .card.classic-queen-hearts { background-position: 354px 982px; }
        .card.classic-king-hearts { background-position: -26px 867px; }
        .card.classic-ace-hearts { background-position: 354px 867px; }

        .card.classic-2-spades { background-position: -26px 593px; }
        .card.classic-3-spades { background-position: -110px 593px; }
        .card.classic-4-spades { background-position: -194px 593px; }
        .card.classic-5-spades { background-position: -278px 593px; }
        .card.classic-6-spades { background-position: -362px 593px; }
        .card.classic-7-spades { background-position: -446px 593px; }
        .card.classic-8-spades { background-position: -530px 593px; }
        .card.classic-9-spades { background-position: -614px 593px; }
        .card.classic-10-spades { background-position: -698px 593px; }
        .card.classic-jack-spades { background-position: 606px 982px; }
        .card.classic-queen-spades { background-position: 270px 982px; }
        .card.classic-king-spades { background-position: 690px 867px; }
        .card.classic-ace-spades { background-position: 438px 867px; }

        .card.classic-2-clubs { background-position: -26px 708px; }
        .card.classic-3-clubs { background-position: -110px 708px; }
        .card.classic-4-clubs { background-position: -194px 708px; }
        .card.classic-5-clubs { background-position: -278px 708px; }
        .card.classic-6-clubs { background-position: -362px 708px; }
        .card.classic-7-clubs { background-position: -446px 708px; }
        .card.classic-8-clubs { background-position: -530px 708px; }
        .card.classic-9-clubs { background-position: -614px 708px; }
        .card.classic-10-clubs { background-position: -698px 708px; }
        .card.classic-jack-clubs { background-position: -26px 982px; }
        .card.classic-queen-clubs { background-position: 438px 982px; }
        .card.classic-king-clubs { background-position: 103px 982px; }
        .card.classic-ace-clubs { background-position: 522px 867px; }
    </style>
</head>
<body>
    <div id="wait">
        <div class="lds-ripple"><div></div><div></div></div>
        <div>Ожидание подключения других пользователей</div>
    </div>
    <div id="game" class="hidden">
        <div id="players"></div>
        <div id="discard"></div>
        <div id="bank" onclick="takeCard()"></div>
        <div id="hand"></div>
    </div>
    <script type="text/javascript">
        function takeCard() {
            conn.send(JSON.stringify({event: 'move', data: {takeCard: true}}));
        }
        function render (info) {
            var wait = document.getElementById('wait');
            wait.className = 'hidden';
            var game = document.getElementById('game');
            game.className = '';
            if (info.IsCompleted) {
                alert('Игра окончена');
            }
            var players = document.getElementById('players');
            players.innerHTML = '';
            for (var key in info.Players) {
                if (info.Players[key].Id !== info.PlayerId) {
                    var player = document.createElement("div");
                    player.className = 'player-info';
                    if (info.Players[key].Id === info.CurrentPlayerId) {
                        player.className += ' active';
                    }
                    var avatar = document.createElement("div");
                    avatar.className = 'player-avatar';
                    avatar.textContent = info.Players[key].Id + 1;
                    player.appendChild(avatar);
                    var playerHand = document.createElement("div");
                    playerHand.className = 'player-hand';
                    for (var i = 1; i <= info.Players[key].HandCount; i++) {
                        playerHand.appendChild(document.createElement("div"));
                    }
                    player.appendChild(playerHand);
                    players.appendChild(player);
                }
            }

            var discard = document.getElementById('discard');
            discard.className = '';
            if (info.TopCard.Code) {
                discard.className = 'card classic-' + info.TopCard.Code;
            }

            var hand = document.getElementById('hand');
            hand.className = '';
            if (info.PlayerId === info.CurrentPlayerId) {
                hand.className = 'active';
            }
            hand.innerHTML = '';
            var myAvatar = document.createElement("div");
            myAvatar.className = 'player-avatar';
            myAvatar.textContent = info.PlayerId + 1;
            hand.appendChild(myAvatar);
            for (var key in info.Hand) {
                var card = document.createElement("span");
                card.className = 'card classic-' + info.Hand[key].Code;
                card.dataset.code = info.Hand[key].Code;
                card.onclick = function (e) {
                    conn.send(JSON.stringify({event: 'move', data: {cardCode: e.target.dataset.code}}));
                };
                hand.appendChild(card);
            }
        }
        if (window["WebSocket"]) {
            conn = new WebSocket("ws://" + location.host + "/ws" + location.pathname);
            conn.onclose = function (evt) {
                console.log('close');
            };
            conn.onmessage = function (evt) {
                var msg = JSON.parse(evt.data);
                render(msg)
                console.log('message', msg);
            };
            conn.onopen = function (evt) {
                conn.send(JSON.stringify({event: "enter", 'data': location.pathname}));
                console.log('open');
            }
        } else {
            var item = document.createElement("div");
            item.innerHTML = "<b>Ваш браузер не поддерживает WebSockets.</b>";
            var wait = document.getElementById('wait');
            wait.innerHTML = '';
            wait.appendChild(item);
        }
    </script>
</body>
</html>
